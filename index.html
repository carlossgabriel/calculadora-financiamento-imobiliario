<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Financiamento Imobiliário</title>
<style>
  :root { --bg:#f5f5f5; --card:#fff; --ink:#1a1a1a; --muted:#666; --accent:#0a66c2; }
  * { box-sizing: border-box; }
  body { margin:0; background:var(--bg); color:var(--ink); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  .container { margin: 40px auto; padding: 0 16px; }
  h1 { text-align:center; margin: 0 0 24px; }
  .card { background:var(--card); border:1px solid #ddd; border-radius:12px; padding:18px; }
  .form-columns, .results-columns { display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; }
@media (max-width: 1200px){
  .form-columns, .results-columns { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 900px){
  .form-columns, .results-columns { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 640px){
  .form-columns, .results-columns { grid-template-columns: 1fr; }
}
  .col { min-width: 0; }
  .col h3 { margin: 0 0 10px; font-size: 18px; }
  .group { margin-bottom:12px; }
  label { display:block; font-weight:600; margin:0 0 6px; }
  input[type="number"], input[type="text"] { width:100%; padding:14px 14px; border:1px solid #ccc; border-radius:10px; background:#fff; }
  .section-title { margin:22px 0 10px; font-size:18px; font-weight:700; }
  .btn { display:block; width:100%; background:var(--accent); color:#fff; border:none; border-radius:8px; padding:14px; font-weight:700; cursor:pointer; position:sticky; bottom:0; }
  .btn:hover { filter:brightness(0.95); }
  .results { margin-top:16px; }
  .results h2 { margin:0 0 12px; }
  .kv { margin:8px 0; line-height: 1.5; }
  .kv-item { margin:2px 0; padding:2px 0; }
  .kv-label { font-weight:600; color:var(--muted); font-size:14px; }
  .kv-value { font-weight:700; font-size:16px; margin-top:2px; }
  .kv-highlight { background:#f0f8ff; padding:8px; border-radius:6px; border-left:3px solid var(--accent); }
  .muted { color:var(--muted); }
  .warn { color:#a30; font-weight:700; }
</style>
</head>
<body>
  <div class="container">
    <h1>Calculadora de Financiamento Imobiliário</h1>

    <div class="card">
      <div class="form-columns">
        <!-- 1. Renda e recursos -->
        <div class="col">
          <h3>1) Renda e recursos</h3>
          <div class="group">
            <label for="salario">Salário líquido mensal (R$)</label>
            <input type="number" id="salario" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="6150" step="50" min="0" />
          </div>
          <div class="group">
            <label for="fgts">Valor total de FGTS a utilizar (R$)</label>
            <input type="number" id="fgts" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="0" step="100" min="0" />
          </div>
          <div class="group">
            <label for="ganhoCarro">Ganho com venda do carro (R$)</label>
            <input type="number" id="ganhoCarro" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="0" step="100" min="0" />
          </div>
          <div class="group">
            <label for="reservas">Reservas em contas (R$) — excluindo FGTS e venda de carro</label>
            <input type="number" id="reservas" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="60000" step="100" min="0" />
          </div>
        </div>

        <!-- 2. Custos do imóvel -->
        <div class="col">
          <h3>2) Custos do imóvel</h3>
          <div class="group">
            <label for="valorImovel">Valor do imóvel (R$)</label>
            <input type="number" id="valorImovel" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="270000" step="1000" min="0" />
          </div>
          <div class="group">
            <label for="entradaTipo">Tipo de entrada</label>
            <select id="entradaTipo" style="width:100%; padding:14px; border:1px solid #ccc; border-radius:10px; background:#fff;">
              <option value="percent">Percentual (%)</option>
              <option value="value">Valor fixo (R$)</option>
            </select>
          </div>
          <div class="group">
            <label for="entradaPercent" id="entradaLabel">Percentual da entrada (%)</label>
            <input type="number" id="entradaPercent" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="20" step="1" min="0" max="100" />
          </div>
          <div class="group">
            <label for="prazo">Prazo do financiamento (meses)</label>
            <input type="number" id="prazo" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="420" step="10" min="1" />
          </div>
          <div class="group">
            <label for="juros">Taxa de juros anual (% a.a.)</label>
            <input type="number" id="juros" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="8.16" step="0.01" min="0" />
          </div>
        </div>

        <!-- 3. Custos indiretos -->
        <div class="col">
          <h3>3) Custos indiretos</h3>
          <div class="group">
            <label for="itbi">Percentual do ITBI (%)</label>
            <input type="number" id="itbi" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="2" step="0.1" min="0" />
          </div>
          <div class="group">
            <label for="escritura">Percentual da escritura (%)</label>
            <input type="number" id="escritura" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="1" step="0.1" min="0" />
          </div>
          <div class="group">
            <label for="registro">Percentual do registro (%)</label>
            <input type="number" id="registro" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="1" step="0.1" min="0" />
          </div>
          <div class="group">
            <label for="taxas">Taxas bancárias e laudo (R$)</label>
            <input type="number" id="taxas" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="3000" step="100" min="0" />
          </div>
        </div>

        <div class="col">
          <h3>4) Outros custos</h3>
        <div class="group">
          <label for="reforma">Custo da reforma (R$)</label>
          <input type="number" id="reforma" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" value="0" step="500" min="0" />
        </div>
        </div>
      </div>

      <button class="btn" onclick="calcular()">Calcular</button>

      <div class="results" id="result" style="display:none">
        <h2>Resultados</h2>
        <div class="results-columns">
          <!-- Renda e recursos -->
          <div class="col">
            <h3>1) Renda e recursos</h3>
            <div class="kv" id="rendaResumo"></div>
            <div class="kv" id="recursosResumo"></div>
          </div>
          <!-- Custos do imóvel -->
          <div class="col">
            <h3>2) Custos do imóvel</h3>
            <div class="kv" id="entradaResumo"></div>
            <div class="kv" id="financiadoResumo"></div>
            <div class="kv" id="parcelasResumo"></div>
            <div class="kv" id="percentualRenda"></div>
          </div>
          <!-- Custos indiretos -->
          <div class="col">
            <h3>3) Custos indiretos</h3>
            <div class="kv" id="transferResumo"></div>
            <div class="kv" id="desembolsoInicialSemExtras"></div>
            <div class="kv" id="desembolsoResumo"></div>
          </div>
          <!-- Outros custos e resumo -->
          <div class="col">
            <h3>4) Resumo final</h3>
            <div class="kv" id="reformaResumo"></div>
            <div class="kv" id="saldoResumo"></div>
            <div class="kv warn" id="aviso"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
function fmt(v){ return Number(v).toLocaleString('pt-BR', {style:'currency', currency:'BRL'}); }

// Handle entrada type change
function handleEntradaTipoChange() {
  const tipo = document.getElementById('entradaTipo').value;
  const label = document.getElementById('entradaLabel');
  const input = document.getElementById('entradaPercent');
  
  if (tipo === 'percent') {
    label.textContent = 'Percentual da entrada (%)';
    input.value = '20';
    input.step = '1';
    input.min = '0';
    input.max = '100';
  } else {
    label.textContent = 'Valor da entrada (R$)';
    input.value = '54000';
    input.step = '1000';
    input.min = '0';
    input.removeAttribute('max');
  }
}

// Initialize entrada type handler
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('entradaTipo').addEventListener('change', handleEntradaTipoChange);
});

function calcPrice(PV, annualRate, n){
  const i = (annualRate/100)/12;
  if(i === 0) return PV / n;
  return PV * i / (1 - Math.pow(1+i, -n));
}
function calcSACFirst(PV, annualRate, n){
  const i = (annualRate/100)/12;
  const amort = PV / n;
  return amort + PV * i;
}

function calcular(){
  // inputs
  const norm = v => String(v).replace(',', '.');
  const salario   = parseFloat(norm(document.getElementById('salario').value)||0);
  const fgts      = parseFloat(norm(document.getElementById('fgts').value)||0);
  const ganho     = parseFloat(norm(document.getElementById('ganhoCarro').value)||0);
  const reservas  = parseFloat(norm(document.getElementById('reservas').value)||0);

  const valor     = parseFloat(norm(document.getElementById('valorImovel').value)||0);
  const entradaTipo = document.getElementById('entradaTipo').value;
  const entradaInput = parseFloat(norm(document.getElementById('entradaPercent').value)||0);
  const prazo     = parseInt(document.getElementById('prazo').value||0, 10);
  const juros     = parseFloat(norm(document.getElementById('juros').value)||0);

  const reforma   = parseFloat(norm(document.getElementById('reforma').value)||0);
  const itbiP     = parseFloat(norm(document.getElementById('itbi').value)||0);
  const escritP   = parseFloat(norm(document.getElementById('escritura').value)||0);
  const regP      = parseFloat(norm(document.getElementById('registro').value)||0);
  const taxas     = parseFloat(norm(document.getElementById('taxas').value)||0);

  // cálculos principais
  const entradaValor = entradaTipo === 'percent' ? valor * (entradaInput/100) : entradaInput;
  const entradaPercent = entradaTipo === 'percent' ? entradaInput : (entradaValor/valor)*100;
  const financiado   = Math.max(0, valor - entradaValor);
  const parcelaPrice = calcPrice(financiado, juros, prazo);
  const primeiraSAC  = calcSACFirst(financiado, juros, prazo);
  const percRenda    = salario > 0 ? (parcelaPrice / salario) * 100 : 0;

  const itbi      = valor * (itbiP/100);
  const escritura = valor * (escritP/100);
  const registro  = valor * (regP/100);
  const transfer  = itbi + escritura + registro + taxas;

  const desembolsoInicialSemExtras = entradaValor + transfer;
  const recursosTotais    = reservas + fgts + ganho;
  const saldoPosCustos    = recursosTotais - reforma - desembolsoInicialSemExtras;

  // preencher resultados
  document.getElementById('rendaResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Salário líquido mensal</div>
      <div class="kv-value">${fmt(salario)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Compromisso máximo (30% da renda)</div>
      <div class="kv-value">${fmt(salario*0.30)}</div>
    </div>
  `;
  
  document.getElementById('recursosResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Reservas em contas</div>
      <div class="kv-value">${fmt(reservas)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">FGTS disponível</div>
      <div class="kv-value">${fmt(fgts)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Ganho com venda do carro</div>
      <div class="kv-value">${fmt(ganho)}</div>
    </div>
    <div class="kv-item kv-highlight">
      <div class="kv-label">Total de recursos</div>
      <div class="kv-value">${fmt(recursosTotais)}</div>
    </div>
  `;
  
  document.getElementById('percentualRenda').innerHTML = `
    <div class="kv-item kv-highlight">
      <div class="kv-label">Percentual da renda comprometido</div>
      <div class="kv-value">${percRenda.toFixed(1)}%</div>
    </div>
  `;

  document.getElementById('entradaResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Valor da entrada (${entradaPercent.toFixed(1)}%)</div>
      <div class="kv-value">${fmt(entradaValor)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Valor a ser financiado</div>
      <div class="kv-value">${fmt(financiado)}</div>
    </div>
  `;
  
  document.getElementById('financiadoResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Prazo do financiamento</div>
      <div class="kv-value">${prazo} meses</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Taxa de juros anual</div>
      <div class="kv-value">${juros.toFixed(2)}% a.a.</div>
    </div>
  `;
  
  document.getElementById('parcelasResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Parcela (Sistema Price)</div>
      <div class="kv-value">${fmt(parcelaPrice)}</div>
    </div>
    <div class="kv-item kv-highlight">
      <div class="kv-label">Primeira parcela (Sistema SAC)</div>
      <div class="kv-value">${fmt(primeiraSAC)}</div>
    </div>
  `;

  document.getElementById('reformaResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">Custo da reforma</div>
      <div class="kv-value">${fmt(reforma)}</div>
    </div>
  `;
  
  document.getElementById('transferResumo').innerHTML = `
    <div class="kv-item">
      <div class="kv-label">ITBI</div>
      <div class="kv-value">${fmt(itbi)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Escritura</div>
      <div class="kv-value">${fmt(escritura)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Registro</div>
      <div class="kv-value">${fmt(registro)}</div>
    </div>
    <div class="kv-item">
      <div class="kv-label">Taxas bancárias e laudo</div>
      <div class="kv-value">${fmt(taxas)}</div>
    </div>
    <div class="kv-item kv-highlight">
      <div class="kv-label">Total custos de transferência</div>
      <div class="kv-value">${fmt(transfer)}</div>
    </div>
  `;
  
  document.getElementById('desembolsoInicialSemExtras').innerHTML = `
    <div class="kv-item kv-highlight">
      <div class="kv-label">Desembolso inicial (entrada + transferência)</div>
      <div class="kv-value">${fmt(desembolsoInicialSemExtras)}</div>
    </div>
  `;
   
  document.getElementById('saldoResumo').innerHTML = `
    <div class="kv-item ${saldoPosCustos < 0 ? 'warn' : ''}">
      <div class="kv-label">Saldo após custos iniciais</div>
      <div class="kv-value">${fmt(saldoPosCustos)}</div>
    </div>
  `;

  const aviso = percRenda > 30 ?
    `A parcela calculada (${fmt(parcelaPrice)}) excede 30% da renda. Considere aumentar a entrada ou buscar taxa menor.` :
    `Parcela dentro de 30% da renda.`;
  document.getElementById('aviso').textContent = aviso;

  document.getElementById('result').style.display = 'block';
  document.getElementById('result').scrollIntoView({behavior:'smooth', block:'start'});
}
</script>
</body>
</html>
